import{_ as he,r as i,y as Se,P as Ee,v as k,I as v,d as a,w as l,l as C,a2 as re,M as Ne,o as d,W as z,g as s,j as x,i as n,a8 as _e,a9 as ne,h as A,c as D,m as P,Y as J,t as u,G as $,aa as ze,ab as ie,U as X,X as f,q as w,T as ue,a0 as Y,S as Z,Z as de,ag as De,J as B,a1 as K,F as me,ah as Pe,H as Te,A as je,C as Ie,L as Le,n as Me,s as ce,a4 as ve}from"./index-BIk10ILk.js";const $e={class:"d-flex flex-column flex-sm-row justify-space-between align-start align-sm-center gap-3"},Be={key:0,class:"text-center pa-12"},Fe={key:1,class:"text-center pa-12"},qe={class:"d-flex align-center"},Oe={class:"text-caption"},Re={class:"d-none d-sm-table-cell"},We={class:"d-none d-md-table-cell"},Ge={class:"d-flex justify-center gap-1"},He={key:0,class:"text-center pa-12"},Je={key:1,class:"text-center pa-12"},Xe={key:2,class:"pa-4"},Ye={class:"d-flex justify-space-between align-center"},Ze={class:"d-flex align-center mb-2"},Ke={class:"text-caption"},Qe={class:"text-body-2 font-weight-bold mb-1"},ea={class:"text-caption text-grey"},aa={key:0,class:"text-caption text-grey mt-2"},la={class:"text-caption text-grey mt-1"},ta={class:"d-flex gap-2"},oa={class:"d-flex align-center"},sa={class:"text-body-1 text-md-h6 font-weight-bold"},ra={class:"text-body-2 text-md-body-1 mb-4"},na={__name:"Usuarios",setup(ia){const Q=i([]),h=i([]),F=i(!1),q=i(!1),T=i("usuarios"),b=i({busca:"",tipo:null}),ee=[{title:"Administrador",value:"Administrador"},{title:"Professor",value:"Professor"},{title:"Aluno",value:"Aluno"}],fe={Administrador:1,Professor:2,Aluno:3},S=i(!1),E=i(!1),p=i(null),O=i(null),ae=i(null),R=i(!1),W=i(!1),y=i(null),j=i(!1),I=i(!1),L=i(!1),r=i({nome:"",login:"",tipo:null,senha:"",matricula:"",senhaAtual:"",senhaNova:""}),N=i({show:!1,mensagem:"",color:"success"}),V={obrigatorio:o=>o!=null&&o!==""||"Campo obrigatório",email:o=>/.+@.+\..+/.test(o)||"Email inválido",senhaMinima:o=>!o||o.length>=6||"Senha deve ter no mínimo 6 caracteres",senhaMinimaOpcional:o=>!o||o.length===0||o.length>=6||"Senha deve ter no mínimo 6 caracteres"},G=Se(()=>{let o=[...Q.value];if(b.value.busca&&b.value.busca.trim()!==""){const e=b.value.busca.toLowerCase().trim();o=o.filter(t=>{var m,U,_;return((m=t.nome)==null?void 0:m.toLowerCase().includes(e))||((U=t.login)==null?void 0:U.toLowerCase().includes(e))||((_=t.id)==null?void 0:_.toString().includes(e))})}return b.value.tipo&&(o=o.filter(e=>e.tipo===b.value.tipo)),o});Ee(()=>{M(),H()});async function M(){F.value=!0;try{const o=await k.listarTodos();Q.value=o}catch(o){console.error("Erro ao carregar usuários:",o),g("Erro ao carregar usuários","error")}finally{F.value=!1}}function le(o){return(o==null?void 0:o.split(" ").map(e=>e[0]).join("").substring(0,2).toUpperCase())||"U"}function pe(o){return{Administrador:"error",Professor:"primary",Aluno:"success"}[o]||"grey"}function ge(){p.value=null,r.value={nome:"",login:"",tipo:null,senha:"",matricula:"",senhaAtual:"",senhaNova:""},y.value=null,S.value=!0}function be(o){p.value=o,r.value={nome:o.nome,login:o.login,tipo:o.tipo,senha:"",matricula:o.matricula||"",senhaAtual:"",senhaNova:""},y.value=null,S.value=!0}function te(){S.value=!1,p.value=null,r.value={nome:"",login:"",tipo:null,senha:"",matricula:"",senhaAtual:"",senhaNova:""},y.value=null}async function ye(){var e,t,m,U,_,oe,se;const{valid:o}=await ae.value.validate();if(o){R.value=!0,y.value=null;try{if(p.value){const c={nome:r.value.nome,matricula:r.value.matricula||null};r.value.senhaAtual&&r.value.senhaNova&&(c.senhaAtual=r.value.senhaAtual,c.senhaNova=r.value.senhaNova),await k.atualizar(p.value.id,c),g("Usuário atualizado com sucesso!","success")}else{const c={nome:r.value.nome,login:r.value.login,senha:r.value.senha,tipo:fe[r.value.tipo]};r.value.matricula&&(c.matricula=r.value.matricula),await k.criar(c),g("Usuário criado com sucesso!","success")}te(),M()}catch(c){if(console.error("Erro ao salvar:",((e=c.response)==null?void 0:e.data)||c),(m=(t=c.response)==null?void 0:t.data)!=null&&m.errors){const Ue=c.response.data.errors,Ae=Object.values(Ue).flat().join(", ");y.value=Ae}else y.value=((_=(U=c.response)==null?void 0:U.data)==null?void 0:_.message)||((se=(oe=c.response)==null?void 0:oe.data)==null?void 0:se.title)||"Erro ao salvar usuário"}finally{R.value=!1}}}function xe(o){O.value=o,E.value=!0}async function Ve(){W.value=!0;try{await k.deletar(O.value.id),g("Usuário excluído com sucesso!","success"),E.value=!1,M()}catch{g("Erro ao excluir usuário","error")}finally{W.value=!1}}function g(o,e="success"){N.value={show:!0,mensagem:o,color:e}}async function H(){q.value=!0;try{const o=await k.listarSolicitacoesPendentes();h.value=o}catch(o){console.error("Erro ao carregar solicitações:",o),g("Erro ao carregar solicitações","error")}finally{q.value=!1}}async function ke(o,e){try{const t={Aluno:3,Professor:2};await k.aprovarAcesso(o.id,t[e]),g(`Solicitação aprovada como ${e}!`,"success"),H(),M()}catch(t){console.error("Erro ao aprovar solicitação:",t),g("Erro ao aprovar solicitação","error")}}async function Ce(o){if(confirm("Tem certeza que deseja rejeitar esta solicitação?"))try{await k.deletar(o.id),g("Solicitação rejeitada!","success"),H()}catch(e){console.error("Erro ao rejeitar solicitação:",e),g("Erro ao rejeitar solicitação","error")}}function we(o){return o?new Date(o).toLocaleDateString("pt-BR",{year:"numeric",month:"2-digit",day:"2-digit"}):"-"}return(o,e)=>(d(),v("div",null,[a(C,{class:"mb-4 mb-md-6",elevation:"1"},{default:l(()=>[a(z,{class:"pa-4 pa-md-6"},{default:l(()=>[s("div",$e,[e[20]||(e[20]=s("div",null,[s("h1",{class:"text-h5 text-md-h4 font-weight-bold mb-2"}," Gerenciar Usuários "),s("p",{class:"text-body-2 text-md-body-1 text-grey-darken-1"}," Visualize, crie e gerencie os usuários do sistema ")],-1)),a(x,{color:"primary","prepend-icon":"mdi-account-plus",class:"text-none",onClick:ge},{default:l(()=>[...e[19]||(e[19]=[n(" Novo Usuário ",-1)])]),_:1})])]),_:1})]),_:1}),a(C,{class:"mb-4 mb-md-6",elevation:"1"},{default:l(()=>[a(_e,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=t=>T.value=t),color:"primary"},{default:l(()=>[a(ne,{value:"usuarios"},{default:l(()=>[a(A,{start:""},{default:l(()=>[...e[21]||(e[21]=[n("mdi-account-multiple",-1)])]),_:1}),e[22]||(e[22]=n(" Usuários ",-1))]),_:1}),a(ne,{value:"solicitacoes"},{default:l(()=>[a(A,{start:""},{default:l(()=>[...e[23]||(e[23]=[n("mdi-bell-ring",-1)])]),_:1}),e[24]||(e[24]=n(" Solicitações Pendentes ",-1)),h.value.length>0?(d(),D(J,{key:0,color:"error",size:"small",class:"ml-2"},{default:l(()=>[n(u(h.value.length),1)]),_:1})):P("",!0)]),_:1})]),_:1},8,["modelValue"]),a($),a(ze,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t)},{default:l(()=>[a(ie,{value:"usuarios"},{default:l(()=>[a(C,{elevation:"0",class:"mb-4"},{default:l(()=>[a(z,{class:"pa-4 pa-md-6"},{default:l(()=>[a(X,null,{default:l(()=>[a(f,{cols:"12",sm:"6",md:"6"},{default:l(()=>[a(w,{modelValue:b.value.busca,"onUpdate:modelValue":e[1]||(e[1]=t=>b.value.busca=t),label:"Buscar",placeholder:"Nome, email ou ID",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-magnify",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1}),a(f,{cols:"12",sm:"6",md:"6"},{default:l(()=>[a(ue,{modelValue:b.value.tipo,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value.tipo=t),label:"Tipo de usuário",items:ee,"item-title":"title","item-value":"value",variant:"outlined",density:"comfortable",clearable:"","hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(C,{elevation:"0"},{default:l(()=>[a(Y,{class:"pa-4 pa-md-6 d-flex align-center border-b"},{default:l(()=>[a(A,{class:"mr-2 mr-md-3",color:"grey-darken-2"},{default:l(()=>[...e[25]||(e[25]=[n("mdi-account-multiple",-1)])]),_:1}),e[26]||(e[26]=s("span",{class:"text-body-1 text-md-h6 font-weight-bold"},"Lista de Usuários",-1)),a(Z),a(J,{color:"primary",variant:"flat"},{default:l(()=>[n(u(G.value.length)+" usuários ",1)]),_:1})]),_:1}),a($),F.value?(d(),v("div",Be,[a(de,{indeterminate:"",color:"primary",size:"64"}),e[27]||(e[27]=s("p",{class:"text-grey mt-4"},"Carregando usuários...",-1))])):G.value.length===0?(d(),v("div",Fe,[a(A,{size:"64",color:"grey-lighten-1"},{default:l(()=>[...e[28]||(e[28]=[n("mdi-account-off-outline",-1)])]),_:1}),e[29]||(e[29]=s("p",{class:"text-body-1 text-grey mt-4"},"Nenhum usuário encontrado",-1))])):(d(),D(De,{key:2},{default:l(()=>[e[30]||(e[30]=s("thead",null,[s("tr",null,[s("th",{class:"text-left font-weight-bold"},"ID"),s("th",{class:"text-left font-weight-bold"},"Nome"),s("th",{class:"text-left font-weight-bold d-none d-sm-table-cell"},"Login"),s("th",{class:"text-left font-weight-bold d-none d-md-table-cell"},"Tipo"),s("th",{class:"text-center font-weight-bold"},"Ações")])],-1)),s("tbody",null,[(d(!0),v(B,null,K(G.value,t=>(d(),v("tr",{key:t.id},[s("td",null,u(t.id),1),s("td",null,[s("div",qe,[a(me,{color:"primary",size:"32",class:"mr-2"},{default:l(()=>[s("span",Oe,u(le(t.nome)),1)]),_:2},1024),s("span",null,u(t.nome),1)])]),s("td",Re,u(t.login),1),s("td",We,[a(J,{color:pe(t.tipo),size:"small",variant:"flat"},{default:l(()=>[n(u(t.tipo),1)]),_:2},1032,["color"])]),s("td",null,[s("div",Ge,[a(x,{icon:"mdi-pencil",size:"small",variant:"text",color:"primary",onClick:m=>be(t)},null,8,["onClick"]),a(x,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:m=>xe(t)},null,8,["onClick"])])])]))),128))])]),_:1}))]),_:1})]),_:1}),a(ie,{value:"solicitacoes"},{default:l(()=>[q.value?(d(),v("div",He,[a(de,{indeterminate:"",color:"primary",size:"64"}),e[31]||(e[31]=s("p",{class:"text-grey mt-4"},"Carregando solicitações...",-1))])):h.value.length===0?(d(),v("div",Je,[a(A,{size:"64",color:"grey-lighten-1"},{default:l(()=>[...e[32]||(e[32]=[n("mdi-bell-outline",-1)])]),_:1}),e[33]||(e[33]=s("p",{class:"text-body-1 text-grey mt-4"},"Nenhuma solicitação pendente",-1))])):(d(),v("div",Xe,[a(X,null,{default:l(()=>[(d(!0),v(B,null,K(h.value,t=>(d(),D(f,{key:t.id,cols:"12"},{default:l(()=>[a(C,{class:"mb-2"},{default:l(()=>[a(z,{class:"pa-4"},{default:l(()=>[s("div",Ye,[s("div",null,[s("div",Ze,[a(me,{color:"warning",size:"40",class:"mr-3"},{default:l(()=>[s("span",Ke,u(le(t.nome)),1)]),_:2},1024),s("div",null,[s("p",Qe,u(t.nome),1),s("p",ea,u(t.login),1)])]),t.matricula?(d(),v("p",aa,[e[34]||(e[34]=s("strong",null,"Matrícula:",-1)),n(" "+u(t.matricula),1)])):P("",!0),s("p",la,[e[35]||(e[35]=s("strong",null,"Solicitado em:",-1)),n(" "+u(we(t.dataCriacao)),1)])]),s("div",ta,[a(Pe,null,{activator:l(({props:m})=>[a(x,Le({color:"success",variant:"flat",size:"small","prepend-icon":"mdi-check"},{ref_for:!0},m,{class:"text-none"}),{default:l(()=>[...e[36]||(e[36]=[n(" Aprovar ",-1)])]),_:1},16)]),default:l(()=>[a(Te,{density:"compact"},{default:l(()=>[(d(),v(B,null,K(["Aluno","Professor"],m=>a(je,{key:m,onClick:U=>ke(t,m)},{default:l(()=>[a(Ie,null,{default:l(()=>[n("Como "+u(m),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:2},1024)]),_:2},1024),a(x,{color:"error",variant:"outlined",size:"small","prepend-icon":"mdi-close",onClick:m=>Ce(t),class:"text-none"},{default:l(()=>[...e[37]||(e[37]=[n(" Rejeitar ",-1)])]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(re,{modelValue:S.value,"onUpdate:modelValue":e[15]||(e[15]=t=>S.value=t),"max-width":"600",persistent:""},{default:l(()=>[a(C,null,{default:l(()=>[a(Y,{class:"pa-4 pa-md-6 bg-grey-lighten-5 border-b"},{default:l(()=>[s("div",oa,[a(A,{class:"mr-2",color:"grey-darken-2"},{default:l(()=>[n(u(p.value?"mdi-account-edit":"mdi-account-plus"),1)]),_:1}),s("span",sa,u(p.value?"Editar Usuário":"Novo Usuário"),1)])]),_:1}),a(z,{class:"pa-4 pa-md-6"},{default:l(()=>[a(Me,{ref_key:"formUsuario",ref:ae},{default:l(()=>[a(X,null,{default:l(()=>[a(f,{cols:"12"},{default:l(()=>[e[38]||(e[38]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Nome completo",-1)),a(w,{modelValue:r.value.nome,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.nome=t),placeholder:"Digite o nome",variant:"outlined",density:"comfortable",rules:[V.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),a(f,{cols:"12"},{default:l(()=>[e[39]||(e[39]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Login (Email)",-1)),a(w,{modelValue:r.value.login,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.login=t),placeholder:"usuario@email.com",type:"email",variant:"outlined",density:"comfortable",rules:[V.obrigatorio,V.email],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),a(f,{cols:"12"},{default:l(()=>[e[40]||(e[40]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Tipo de usuário",-1)),a(ue,{modelValue:r.value.tipo,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.tipo=t),items:ee,"item-title":"title","item-value":"value",variant:"outlined",density:"comfortable",rules:[V.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),_:1}),a(f,{cols:"12"},{default:l(()=>[e[41]||(e[41]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Matrícula",-1)),a(w,{modelValue:r.value.matricula,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.matricula=t),placeholder:"Digite a matrícula (opcional)",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue"])]),_:1}),p.value?P("",!0):(d(),D(f,{key:0,cols:"12"},{default:l(()=>[e[42]||(e[42]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Senha",-1)),a(w,{modelValue:r.value.senha,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.senha=t),placeholder:"Mínimo 6 caracteres",type:j.value?"text":"password",variant:"outlined",density:"comfortable","append-inner-icon":j.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[9]||(e[9]=t=>j.value=!j.value),rules:[V.obrigatorio,V.senhaMinima],"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","rules"])]),_:1})),p.value?(d(),v(B,{key:1},[a(f,{cols:"12"},{default:l(()=>[a($,{class:"my-2"}),e[43]||(e[43]=s("p",{class:"text-caption text-grey-darken-1 mb-2"},"Deixe em branco para não alterar a senha",-1))]),_:1}),a(f,{cols:"12"},{default:l(()=>[e[44]||(e[44]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Senha Atual",-1)),a(w,{modelValue:r.value.senhaAtual,"onUpdate:modelValue":e[10]||(e[10]=t=>r.value.senhaAtual=t),placeholder:"Digite a senha atual",type:I.value?"text":"password",variant:"outlined",density:"comfortable","append-inner-icon":I.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[11]||(e[11]=t=>I.value=!I.value),"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon"])]),_:1}),a(f,{cols:"12"},{default:l(()=>[e[45]||(e[45]=s("label",{class:"text-body-2 text-grey-darken-2 mb-2 d-block"},"Nova Senha",-1)),a(w,{modelValue:r.value.senhaNova,"onUpdate:modelValue":e[12]||(e[12]=t=>r.value.senhaNova=t),placeholder:"Mínimo 6 caracteres",type:L.value?"text":"password",variant:"outlined",density:"comfortable","append-inner-icon":L.value?"mdi-eye-off":"mdi-eye","onClick:appendInner":e[13]||(e[13]=t=>L.value=!L.value),rules:[V.senhaMinimaOpcional],"hide-details":"auto"},null,8,["modelValue","type","append-inner-icon","rules"])]),_:1})],64)):P("",!0)]),_:1})]),_:1},512),y.value?(d(),D(ce,{key:0,type:"error",class:"mt-4",variant:"tonal",closable:"","onClick:close":e[14]||(e[14]=t=>y.value=null)},{default:l(()=>[n(u(y.value),1)]),_:1})):P("",!0)]),_:1}),a($),a(ve,{class:"pa-4"},{default:l(()=>[a(Z),a(x,{color:"grey",variant:"text",class:"text-none",onClick:te},{default:l(()=>[...e[46]||(e[46]=[n(" Cancelar ",-1)])]),_:1}),a(x,{color:"primary",variant:"flat",class:"text-none",loading:R.value,onClick:ye},{default:l(()=>[n(u(p.value?"Salvar":"Criar"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(re,{modelValue:E.value,"onUpdate:modelValue":e[17]||(e[17]=t=>E.value=t),"max-width":"500"},{default:l(()=>[a(C,null,{default:l(()=>[a(Y,{class:"pa-4 pa-md-6 bg-error text-white"},{default:l(()=>[...e[47]||(e[47]=[s("span",{class:"text-body-1 text-md-h6 font-weight-bold"},"Confirmar Exclusão",-1)])]),_:1}),a(z,{class:"pa-4 pa-md-6"},{default:l(()=>{var t;return[s("p",ra,[e[48]||(e[48]=n(" Tem certeza que deseja excluir o usuário ",-1)),s("strong",null,u((t=O.value)==null?void 0:t.nome),1),e[49]||(e[49]=n("? ",-1))]),a(ce,{type:"warning",variant:"tonal",density:"compact"},{default:l(()=>[...e[50]||(e[50]=[n(" Esta ação não pode ser desfeita. ",-1)])]),_:1})]}),_:1}),a(ve,{class:"pa-4"},{default:l(()=>[a(Z),a(x,{color:"grey",variant:"text",class:"text-none",onClick:e[16]||(e[16]=t=>E.value=!1)},{default:l(()=>[...e[51]||(e[51]=[n(" Cancelar ",-1)])]),_:1}),a(x,{color:"error",variant:"flat",class:"text-none",loading:W.value,onClick:Ve},{default:l(()=>[...e[52]||(e[52]=[n(" Excluir ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Ne,{modelValue:N.value.show,"onUpdate:modelValue":e[18]||(e[18]=t=>N.value.show=t),color:N.value.color,timeout:3e3},{default:l(()=>[n(u(N.value.mensagem),1)]),_:1},8,["modelValue","color"])]))}},da=he(na,[["__scopeId","data-v-be59c13a"]]);export{da as default};
