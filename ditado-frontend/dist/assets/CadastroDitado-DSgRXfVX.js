import{_ as la,r as u,y as $,O as sa,S as da,a5 as na,I as W,d as e,w as o,l as T,M as ia,a as ua,o as b,U as I,g as r,t as V,j as D,i as l,n as ca,c as _,m as k,T as va,W as X,$ as H,h as G,q as ma,a6 as J,s as K,X as fa,G as pa,a4 as ga,R as ba}from"./index-CiDA2lG_.js";import{d as U}from"./ditadoService-ulOclhXP.js";const ya={class:"d-flex align-center justify-space-between"},xa={class:"text-h4 font-weight-bold mb-2"},wa={class:"text-body-1 text-grey-darken-1"},Va={class:"mb-6"},Da={class:"mb-6"},ka={class:"mb-4"},Ca={class:"text-h6 font-weight-bold mb-4 d-flex align-center"},_a={class:"d-flex align-center gap-3 mb-4"},Ea={key:0},ha=["src"],Ma={__name:"CadastroDitado",setup(Ta){const Q=ua(),Y=sa(),S=u(null),Z=u(null),y=$(()=>Y.params.id),f=$(()=>!!y.value),n=u({titulo:"",descricao:"",textoComMarcacoes:""});let j=null;const B=u(!1),A=u(!1),v=u(null),p=u(!1),c=u(null),E=u(0);let x=null,P=[],h=null;const C=u({show:!1,mensagem:"",color:"success"}),F={obrigatorio:t=>t!=null&&t!==""||"Campo obrigatório"};da(async()=>{console.log("CadastroDitado mounted, editando:",f.value,"ditadoId:",y.value),f.value&&await aa()});async function aa(){var t,a,s;A.value=!0,v.value=null;try{console.log("Carregando ditado com ID:",y.value);try{const d=await U.buscarPorId(y.value);console.log("Ditado carregado do backend:",d),N(d)}catch(d){if(console.log("Falha ao carregar do backend, tentando carregar lista completa..."),((t=d.response)==null?void 0:t.status)===404){const g=(await U.listarTodos()).find(M=>M.id==y.value);if(g)console.log("Ditado encontrado na lista:",g),j=g,N(g);else throw new Error("Ditado não encontrado na lista")}else throw d}}catch(d){console.error("Erro ao carregar ditado:",d);const w=((s=(a=d.response)==null?void 0:a.data)==null?void 0:s.message)||d.message||"Erro ao carregar ditado";v.value=w,m(w,"error")}finally{A.value=!1}}function N(t){if(!t)throw new Error("Ditado não encontrado");j=t,n.value={titulo:t.titulo||"",descricao:t.descricao||"",textoComMarcacoes:t.textoComMarcacoes||""}}async function q(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});x=new MediaRecorder(t),P=[],x.ondataavailable=a=>{P.push(a.data)},x.onstop=()=>{const a=new Blob(P,{type:"audio/webm"}),s=new FileReader;s.onload=()=>{c.value=s.result},s.readAsDataURL(a),t.getTracks().forEach(d=>d.stop())},x.start(),p.value=!0,E.value=0,h=setInterval(()=>{E.value++},1e3)}catch(t){console.error("Erro ao acessar microfone:",t),m("Erro ao acessar o microfone. Verifique as permissões.","error")}}function O(){x&&p.value&&(x.stop(),p.value=!1,clearInterval(h))}function ea(){c.value=null,E.value=0,q()}async function oa(){var a,s,d,w,g,M,L;const{valid:t}=await S.value.validate();if(!t){m("Por favor, preencha todos os campos obrigatórios","warning");return}if(!n.value.titulo||!n.value.textoComMarcacoes){m("Por favor, preencha o título e o ditado","warning");return}if(!f.value&&!c.value){m("Por favor, grave um áudio","warning");return}B.value=!0,v.value=null;try{const i={titulo:n.value.titulo,descricao:n.value.descricao||"",textoComMarcacoes:n.value.textoComMarcacoes};if(c.value){const z=c.value.split(",")[1];i.audioBase64=z}f.value?(await U.atualizar(y.value,i),m("Ditado atualizado com sucesso!","success")):(await U.criar(i),m("Ditado cadastrado com sucesso!","success")),setTimeout(()=>{R()},1500)}catch(i){if(console.error("Erro ao salvar ditado:",((a=i.response)==null?void 0:a.data)||i),(d=(s=i.response)==null?void 0:s.data)!=null&&d.errors){const z=i.response.data.errors,ra=Object.values(z).flat().join(", ");v.value=ra}else v.value=((g=(w=i.response)==null?void 0:w.data)==null?void 0:g.message)||((L=(M=i.response)==null?void 0:M.data)==null?void 0:L.title)||"Erro ao salvar ditado";m("Erro ao salvar ditado","error")}finally{B.value=!1}}function ta(){confirm("Deseja realmente cancelar? Todas as alterações serão perdidas.")&&R()}function R(){Q.push("/professor")}function m(t,a="success"){C.value={show:!0,mensagem:t,color:a}}return na(()=>{p.value&&O(),h&&clearInterval(h)}),(t,a)=>(b(),W("div",null,[e(T,{class:"mb-6",elevation:"1"},{default:o(()=>[e(I,{class:"pa-6"},{default:o(()=>[r("div",ya,[r("div",null,[r("h1",xa,V(f.value?"Editar Ditado":"Cadastro de Ditados"),1),r("p",wa,V(f.value?"Atualize os dados do ditado":"Crie e organize ditados para futuras sessões."),1)]),e(D,{color:"primary",size:"large","prepend-icon":"mdi-view-list",variant:"outlined",class:"text-none",onClick:R},{default:o(()=>[...a[5]||(a[5]=[l(" Ver Banco ",-1)])]),_:1})])]),_:1})]),_:1}),e(T,{elevation:"1"},{default:o(()=>[e(I,{class:"pa-6"},{default:o(()=>[e(ca,{ref_key:"formDitado",ref:S},{default:o(()=>[e(va,null,{default:o(()=>[e(X,{cols:"12",md:"6"},{default:o(()=>[e(T,{elevation:"0",class:"border"},{default:o(()=>[e(H,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(G,{class:"mr-2"},{default:o(()=>[...a[6]||(a[6]=[l("mdi-text",-1)])]),_:1}),a[7]||(a[7]=l(" Detalhes do Ditado ",-1))]),_:1}),e(I,{class:"pa-6"},{default:o(()=>[r("div",Va,[a[8]||(a[8]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Título ",-1)),e(ma,{modelValue:n.value.titulo,"onUpdate:modelValue":a[0]||(a[0]=s=>n.value.titulo=s),placeholder:"Digite o título do ditado",variant:"outlined",density:"comfortable",rules:[F.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),r("div",Da,[a[9]||(a[9]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Descrição ",-1)),e(J,{modelValue:n.value.descricao,"onUpdate:modelValue":a[1]||(a[1]=s=>n.value.descricao=s),placeholder:"Descreva o objetivo ou contexto do ditado",variant:"outlined",density:"comfortable",rows:"3","hide-details":"auto"},null,8,["modelValue"])]),r("div",ka,[a[10]||(a[10]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Ditado ",-1)),e(J,{modelValue:n.value.textoComMarcacoes,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value.textoComMarcacoes=s),placeholder:"Digite o texto do ditado",variant:"outlined",density:"comfortable",rows:"5",rules:[F.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),e(K,{type:"info",variant:"tonal",density:"compact"},{default:o(()=>[...a[11]||(a[11]=[r("div",{class:"text-caption"},[r("strong",null,"Como escrever:"),r("br"),l(" Use colchetes "),r("code",null,"[ ]"),l(" para marcar as palavras que serão omitidas."),r("br"),r("strong",null,"Exemplo:"),l(" O menino foi ao [parque] com seu [cachorro]. ")],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(X,{cols:"12",md:"6"},{default:o(()=>[e(T,{elevation:"0",class:"border"},{default:o(()=>[e(H,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(G,{class:"mr-2"},{default:o(()=>[...a[12]||(a[12]=[l("mdi-music",-1)])]),_:1}),a[13]||(a[13]=l(" Áudio ",-1))]),_:1}),e(I,{class:"pa-6"},{default:o(()=>[r("div",null,[r("h3",Ca,[e(G,{class:"mr-2"},{default:o(()=>[...a[14]||(a[14]=[l("mdi-microphone",-1)])]),_:1}),a[15]||(a[15]=l(" Gravação direta ",-1))]),r("div",_a,[!p.value&&!c.value?(b(),_(D,{key:0,color:"error",variant:"flat","prepend-icon":"mdi-microphone",class:"text-none",onClick:q},{default:o(()=>[...a[16]||(a[16]=[l(" Iniciar ",-1)])]),_:1})):k("",!0),p.value?(b(),_(D,{key:1,color:"grey",variant:"flat","prepend-icon":"mdi-stop",class:"text-none",onClick:O},{default:o(()=>[...a[17]||(a[17]=[l(" Parar ",-1)])]),_:1})):k("",!0),c.value?(b(),_(D,{key:2,color:"primary",variant:"outlined","prepend-icon":"mdi-refresh",class:"text-none",onClick:ea},{default:o(()=>[...a[18]||(a[18]=[l(" Nova gravação ",-1)])]),_:1})):k("",!0),p.value?(b(),_(fa,{key:3,color:"error",variant:"flat"},{default:o(()=>[e(G,{start:""},{default:o(()=>[...a[19]||(a[19]=[l("mdi-circle",-1)])]),_:1}),l(" Gravando... "+V(E.value)+"s ",1)]),_:1})):k("",!0)]),c.value?(b(),W("div",Ea,[r("audio",{ref_key:"audioGravadoPlayer",ref:Z,controls:"",class:"w-100"},[r("source",{src:c.value,type:"audio/webm"},null,8,ha)],512)])):k("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),v.value?(b(),_(K,{key:0,type:"error",class:"mt-6",variant:"tonal",closable:"","onClick:close":a[3]||(a[3]=s=>v.value=null)},{default:o(()=>[l(V(v.value),1)]),_:1})):k("",!0)]),_:1},512)]),_:1}),e(pa),e(ga,{class:"pa-6 bg-grey-lighten-5"},{default:o(()=>[e(D,{variant:"text",class:"text-none","prepend-icon":"mdi-close",onClick:ta},{default:o(()=>[...a[20]||(a[20]=[l(" Cancelar ",-1)])]),_:1}),e(ba),e(D,{color:"primary",variant:"flat",size:"large",class:"text-none px-8","prepend-icon":"mdi-content-save",loading:B.value,onClick:oa},{default:o(()=>[l(V(f.value?"Atualizar Ditado":"Salvar Ditado"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),e(ia,{modelValue:C.value.show,"onUpdate:modelValue":a[4]||(a[4]=s=>C.value.show=s),color:C.value.color,timeout:3e3},{default:o(()=>[l(V(C.value.mensagem),1)]),_:1},8,["modelValue","color"])]))}},Ua=la(Ma,[["__scopeId","data-v-0dd2f20b"]]);export{Ua as default};
