import{_ as R,O as G,r as d,y as x,P as J,v as M,c as m,w as l,f as P,a as j,o as i,d as s,U as A,X as C,l as q,a0 as W,i as r,h as S,t as v,W as X,q as Y,j as E,G as $,ad as H,ae as K,g as n,af as N,I,J as Q,a1 as Z,B as ee,F as ae,Y as T,ag as le,M as se}from"./index-DW5_uCkG.js";import{t as B}from"./turmaService-DXubeasz.js";const oe={class:"bg-grey-lighten-4"},te={style:{width:"50px"}},ne={class:"d-flex align-center gap-2"},re={__name:"InsertAluno",setup(ue){const b=j(),w=G().params.turmaId,k=d(""),_=d([]),g=d([]),t=d([]),f=d(""),y=d(!1),p=d(!1),c=d({show:!1,mensagem:"",color:"success"}),u=x(()=>_.value.filter(a=>a.nome.toLowerCase().includes(f.value.toLowerCase())||a.email.toLowerCase().includes(f.value.toLowerCase()))),h=x(()=>u.value.length===0?!1:u.value.every(a=>t.value.includes(a.id))),L=x(()=>u.value.length===0?!1:u.value.some(a=>t.value.includes(a.id))&&!h.value);function V(a,e="success"){c.value.mensagem=a,c.value.color=e,c.value.show=!0}J(async()=>{await z()});async function z(){y.value=!0;try{const a=await B.obter(w);k.value=a.nome,g.value=a.alunosIds||[];const e=await M.listarTodos();_.value=e.filter(o=>o.tipo==="Aluno"),t.value=[...g.value]}catch(a){console.error("Erro ao carregar dados:",a),V("Erro ao carregar dados","error")}finally{y.value=!1}}function U(a){const e=t.value.indexOf(a);e>-1?t.value.splice(e,1):t.value.push(a)}function F(){h.value?u.value.forEach(a=>{const e=t.value.indexOf(a.id);e>-1&&t.value.splice(e,1)}):u.value.forEach(a=>{t.value.includes(a.id)||t.value.push(a.id)})}async function O(){var a,e;p.value=!0;try{await B.atualizar(w,{alunosIds:t.value}),V("Alunos adicionados com sucesso!","success"),setTimeout(()=>{b.push("/turmas")},1500)}catch(o){console.error("Erro ao salvar alunos:",o),V(((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"Erro ao salvar alunos","error")}finally{p.value=!1}}function D(){b.push("/turmas")}return(a,e)=>(i(),m(P,{class:"py-6"},{default:l(()=>[s(A,null,{default:l(()=>[s(C,{cols:"12"},{default:l(()=>[s(q,{elevation:"0",class:"mb-6"},{default:l(()=>[s(W,{class:"bg-primary text-white pa-4"},{default:l(()=>[s(S,{class:"mr-2"},{default:l(()=>[...e[2]||(e[2]=[r("mdi-account-plus",-1)])]),_:1}),r(" Gerenciar Alunos - "+v(k.value),1)]),_:1}),s(X,{class:"pa-6"},{default:l(()=>[s(A,{class:"mb-6"},{default:l(()=>[s(C,{cols:"12",md:"8"},{default:l(()=>[s(Y,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=o=>f.value=o),label:"Buscar aluno",placeholder:"Nome do aluno","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),s(C,{cols:"12",md:"4",class:"d-flex align-center gap-2"},{default:l(()=>[s(E,{color:"success",disabled:t.value.length===0||p.value,loading:p.value,onClick:O,class:"text-none"},{default:l(()=>[s(S,{class:"mr-2"},{default:l(()=>[...e[3]||(e[3]=[r("mdi-check",-1)])]),_:1}),r(" Salvar ("+v(t.value.length)+") ",1)]),_:1},8,["disabled","loading"]),s(E,{variant:"outlined",onClick:D,class:"text-none"},{default:l(()=>[...e[4]||(e[4]=[r(" Cancelar ",-1)])]),_:1})]),_:1})]),_:1}),s($,{class:"my-4"}),y.value?(i(),m(H,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):u.value.length>0?(i(),m(K,{key:1,class:"bg-transparent"},{default:l(()=>[n("thead",null,[n("tr",oe,[n("th",te,[s(N,{"model-value":h.value,indeterminate:L.value,onChange:F,density:"compact"},null,8,["model-value","indeterminate"])]),e[5]||(e[5]=n("th",null,"Nome",-1)),e[6]||(e[6]=n("th",null,"Email",-1)),e[7]||(e[7]=n("th",null,"Status",-1))])]),n("tbody",null,[(i(!0),I(Q,null,Z(u.value,o=>(i(),I("tr",{key:o.id,class:ee({"bg-green-lighten-5":t.value.includes(o.id)})},[n("td",null,[s(N,{"model-value":t.value.includes(o.id),onChange:ie=>U(o.id),density:"compact"},null,8,["model-value","onChange"])]),n("td",null,[n("div",ne,[s(ae,{size:"32",color:"primary","text-color":"white"},{default:l(()=>[r(v(o.nome.charAt(0).toUpperCase()),1)]),_:2},1024),n("span",null,v(o.nome),1)])]),n("td",null,v(o.email),1),n("td",null,[g.value.includes(o.id)?(i(),m(T,{key:0,color:"success","text-color":"white",size:"small","prepend-icon":"mdi-check"},{default:l(()=>[...e[8]||(e[8]=[r(" Adicionado ",-1)])]),_:1})):(i(),m(T,{key:1,color:"grey-lighten-1","text-color":"grey-darken-2",size:"small"},{default:l(()=>[...e[9]||(e[9]=[r(" Não adicionado ",-1)])]),_:1}))])],2))),128))])]),_:1})):(i(),m(le,{key:2,headline:"Nenhum aluno encontrado",title:"Sem resultados",text:"Não há alunos disponíveis com o filtro selecionado",icon:"mdi-account-search"}))]),_:1})]),_:1})]),_:1})]),_:1}),s(se,{modelValue:c.value.show,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value.show=o),color:c.value.color,timeout:3e3},{default:l(()=>[r(v(c.value.mensagem),1)]),_:1},8,["modelValue","color"])]),_:1}))}},ve=R(re,[["__scopeId","data-v-37fd2ee6"]]);export{ve as default};
