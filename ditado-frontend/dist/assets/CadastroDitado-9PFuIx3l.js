import{_ as ta,r as n,y as O,O as ra,S as la,a5 as sa,I as L,d as e,w as o,l as E,M as da,a as ia,o as p,U as M,g as r,t as y,j as x,i as l,n as na,c as C,m as V,T as ua,W as $,$ as W,h as T,q as ca,a6 as X,s as H,X as va,G as ma,a4 as fa,R as pa}from"./index-Bmu6DO9I.js";import{d as B}from"./ditadoService-CjhB7vYA.js";const ga={class:"d-flex align-center justify-space-between"},ba={class:"text-h4 font-weight-bold mb-2"},ya={class:"text-body-1 text-grey-darken-1"},xa={class:"mb-6"},Va={class:"mb-6"},wa={class:"mb-4"},Ca={class:"text-h6 font-weight-bold mb-4 d-flex align-center"},ka={class:"d-flex align-center gap-3 mb-4"},Da={key:0},_a=["src"],Ea={__name:"CadastroDitado",setup(Ma){const J=ia(),K=ra(),P=n(null),Q=n(null),k=O(()=>K.params.id),g=O(()=>!!k.value),d=n({titulo:"",descricao:"",textoComMarcacoes:""}),h=n(!1),R=n(!1),c=n(null),m=n(!1),u=n(null),D=n(0);let b=null,G=[],_=null;const w=n({show:!1,mensagem:"",color:"success"}),z={obrigatorio:s=>s!=null&&s!==""||"Campo obrigatório"};la(async()=>{g.value&&await Y()});async function Y(){var s,a;R.value=!0,c.value=null;try{console.log("Carregando ditado com ID:",k.value);const t=await B.buscarPorId(k.value);if(console.log("Ditado carregado:",t),!t)throw new Error("Ditado não encontrado");d.value={titulo:t.titulo||"",descricao:t.descricao||"",textoComMarcacoes:t.textoComMarcacoes||""}}catch(t){console.error("Erro ao carregar ditado:",t);const f=((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.message)||t.message||"Erro ao carregar ditado";c.value=f,v(f,"error")}finally{R.value=!1}}async function A(){try{const s=await navigator.mediaDevices.getUserMedia({audio:!0});b=new MediaRecorder(s),G=[],b.ondataavailable=a=>{G.push(a.data)},b.onstop=()=>{const a=new Blob(G,{type:"audio/webm"}),t=new FileReader;t.onload=()=>{u.value=t.result,removerAudio()},t.readAsDataURL(a),s.getTracks().forEach(f=>f.stop())},b.start(),m.value=!0,D.value=0,_=setInterval(()=>{D.value++},1e3)}catch(s){console.error("Erro ao acessar microfone:",s),v("Erro ao acessar o microfone. Verifique as permissões.","error")}}function S(){b&&m.value&&(b.stop(),m.value=!1,clearInterval(_))}function Z(){u.value=null,D.value=0,A()}async function aa(){var a,t,f,j,N,q,F;const{valid:s}=await P.value.validate();if(!s){v("Por favor, preencha todos os campos obrigatórios","warning");return}if(!d.value.titulo||!d.value.textoComMarcacoes){v("Por favor, preencha o título e o ditado","warning");return}if(!g.value&&!u.value){v("Por favor, grave um áudio","warning");return}h.value=!0,c.value=null;try{const i={titulo:d.value.titulo,descricao:d.value.descricao||"",textoComMarcacoes:d.value.textoComMarcacoes};if(u.value){const U=u.value.split(",")[1];i.audioBase64=U}g.value?(await B.atualizar(k.value,i),v("Ditado atualizado com sucesso!","success")):(await B.criar(i),v("Ditado cadastrado com sucesso!","success")),setTimeout(()=>{I()},1500)}catch(i){if(console.error("Erro ao salvar ditado:",((a=i.response)==null?void 0:a.data)||i),(f=(t=i.response)==null?void 0:t.data)!=null&&f.errors){const U=i.response.data.errors,oa=Object.values(U).flat().join(", ");c.value=oa}else c.value=((N=(j=i.response)==null?void 0:j.data)==null?void 0:N.message)||((F=(q=i.response)==null?void 0:q.data)==null?void 0:F.title)||"Erro ao salvar ditado";v("Erro ao salvar ditado","error")}finally{h.value=!1}}function ea(){confirm("Deseja realmente cancelar? Todas as alterações serão perdidas.")&&I()}function I(){J.push("/professor")}function v(s,a="success"){w.value={show:!0,mensagem:s,color:a}}return sa(()=>{m.value&&S(),_&&clearInterval(_)}),(s,a)=>(p(),L("div",null,[e(E,{class:"mb-6",elevation:"1"},{default:o(()=>[e(M,{class:"pa-6"},{default:o(()=>[r("div",ga,[r("div",null,[r("h1",ba,y(g.value?"Editar Ditado":"Cadastro de Ditados"),1),r("p",ya,y(g.value?"Atualize os dados do ditado":"Crie e organize ditados para futuras sessões."),1)]),e(x,{color:"primary",size:"large","prepend-icon":"mdi-view-list",variant:"outlined",class:"text-none",onClick:I},{default:o(()=>[...a[5]||(a[5]=[l(" Ver Banco ",-1)])]),_:1})])]),_:1})]),_:1}),e(E,{elevation:"1"},{default:o(()=>[e(M,{class:"pa-6"},{default:o(()=>[e(na,{ref_key:"formDitado",ref:P},{default:o(()=>[e(ua,null,{default:o(()=>[e($,{cols:"12",md:"6"},{default:o(()=>[e(E,{elevation:"0",class:"border"},{default:o(()=>[e(W,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(T,{class:"mr-2"},{default:o(()=>[...a[6]||(a[6]=[l("mdi-text",-1)])]),_:1}),a[7]||(a[7]=l(" Detalhes do Ditado ",-1))]),_:1}),e(M,{class:"pa-6"},{default:o(()=>[r("div",xa,[a[8]||(a[8]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Título ",-1)),e(ca,{modelValue:d.value.titulo,"onUpdate:modelValue":a[0]||(a[0]=t=>d.value.titulo=t),placeholder:"Digite o título do ditado",variant:"outlined",density:"comfortable",rules:[z.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),r("div",Va,[a[9]||(a[9]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Descrição ",-1)),e(X,{modelValue:d.value.descricao,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value.descricao=t),placeholder:"Descreva o objetivo ou contexto do ditado",variant:"outlined",density:"comfortable",rows:"3","hide-details":"auto"},null,8,["modelValue"])]),r("div",wa,[a[10]||(a[10]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Ditado ",-1)),e(X,{modelValue:d.value.textoComMarcacoes,"onUpdate:modelValue":a[2]||(a[2]=t=>d.value.textoComMarcacoes=t),placeholder:"Digite o texto do ditado",variant:"outlined",density:"comfortable",rows:"5",rules:[z.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),e(H,{type:"info",variant:"tonal",density:"compact"},{default:o(()=>[...a[11]||(a[11]=[r("div",{class:"text-caption"},[r("strong",null,"Como escrever:"),r("br"),l(" Use colchetes "),r("code",null,"[ ]"),l(" para marcar as palavras que serão omitidas."),r("br"),r("strong",null,"Exemplo:"),l(" O menino foi ao [parque] com seu [cachorro]. ")],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e($,{cols:"12",md:"6"},{default:o(()=>[e(E,{elevation:"0",class:"border"},{default:o(()=>[e(W,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(T,{class:"mr-2"},{default:o(()=>[...a[12]||(a[12]=[l("mdi-music",-1)])]),_:1}),a[13]||(a[13]=l(" Áudio ",-1))]),_:1}),e(M,{class:"pa-6"},{default:o(()=>[r("div",null,[r("h3",Ca,[e(T,{class:"mr-2"},{default:o(()=>[...a[14]||(a[14]=[l("mdi-microphone",-1)])]),_:1}),a[15]||(a[15]=l(" Gravação direta ",-1))]),r("div",ka,[!m.value&&!u.value?(p(),C(x,{key:0,color:"error",variant:"flat","prepend-icon":"mdi-microphone",class:"text-none",onClick:A},{default:o(()=>[...a[16]||(a[16]=[l(" Iniciar ",-1)])]),_:1})):V("",!0),m.value?(p(),C(x,{key:1,color:"grey",variant:"flat","prepend-icon":"mdi-stop",class:"text-none",onClick:S},{default:o(()=>[...a[17]||(a[17]=[l(" Parar ",-1)])]),_:1})):V("",!0),u.value?(p(),C(x,{key:2,color:"primary",variant:"outlined","prepend-icon":"mdi-refresh",class:"text-none",onClick:Z},{default:o(()=>[...a[18]||(a[18]=[l(" Nova gravação ",-1)])]),_:1})):V("",!0),m.value?(p(),C(va,{key:3,color:"error",variant:"flat"},{default:o(()=>[e(T,{start:""},{default:o(()=>[...a[19]||(a[19]=[l("mdi-circle",-1)])]),_:1}),l(" Gravando... "+y(D.value)+"s ",1)]),_:1})):V("",!0)]),u.value?(p(),L("div",Da,[r("audio",{ref_key:"audioGravadoPlayer",ref:Q,controls:"",class:"w-100"},[r("source",{src:u.value,type:"audio/webm"},null,8,_a)],512)])):V("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),c.value?(p(),C(H,{key:0,type:"error",class:"mt-6",variant:"tonal",closable:"","onClick:close":a[3]||(a[3]=t=>c.value=null)},{default:o(()=>[l(y(c.value),1)]),_:1})):V("",!0)]),_:1},512)]),_:1}),e(ma),e(fa,{class:"pa-6 bg-grey-lighten-5"},{default:o(()=>[e(x,{variant:"text",class:"text-none","prepend-icon":"mdi-close",onClick:ea},{default:o(()=>[...a[20]||(a[20]=[l(" Cancelar ",-1)])]),_:1}),e(pa),e(x,{color:"primary",variant:"flat",size:"large",class:"text-none px-8","prepend-icon":"mdi-content-save",loading:h.value,onClick:aa},{default:o(()=>[l(y(g.value?"Atualizar Ditado":"Salvar Ditado"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),e(da,{modelValue:w.value.show,"onUpdate:modelValue":a[4]||(a[4]=t=>w.value.show=t),color:w.value.color,timeout:3e3},{default:o(()=>[l(y(w.value.mensagem),1)]),_:1},8,["modelValue","color"])]))}},Ga=ta(Ea,[["__scopeId","data-v-b0f057e6"]]);export{Ga as default};
