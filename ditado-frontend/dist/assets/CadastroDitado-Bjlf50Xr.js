import{_ as la,r as i,y as $,O as sa,S as na,a5 as da,I as W,d as e,w as o,l as I,M as ia,a as ua,o as b,U as G,g as r,t as w,j as V,i as l,n as ca,c as _,m as k,T as va,W as X,$ as H,h as U,q as ma,a6 as J,s as K,X as fa,G as pa,a4 as ga,R as ba}from"./index-CHXsRZee.js";import{d as F}from"./ditadoService-BuScFGNG.js";const ya={class:"d-flex align-center justify-space-between"},xa={class:"text-h4 font-weight-bold mb-2"},wa={class:"text-body-1 text-grey-darken-1"},Va={class:"mb-6"},ka={class:"mb-6"},Ca={class:"mb-4"},Da={class:"text-h6 font-weight-bold mb-4 d-flex align-center"},_a={class:"d-flex align-center gap-3 mb-4"},Ea={key:0},ha=["src"],Ta={__name:"CadastroDitado",setup(Ma){const Q=ua(),Y=sa(),S=i(null),Z=i(null),C=$(()=>Y.params.id),f=$(()=>!!C.value),d=i({titulo:"",descricao:"",textoComMarcacoes:""});let j=null;const B=i(!1),A=i(!1),v=i(null),p=i(!1),u=i(null),E=i(0);let y=null,P=[],h=null;const D=i({show:!1,mensagem:"",color:"success"}),z={obrigatorio:t=>t!=null&&t!==""||"Campo obrigatório"};na(async()=>{console.log("CadastroDitado mounted, editando:",f.value,"ditadoId:",C.value),f.value&&await aa()});async function aa(){var t,a,s;A.value=!0,v.value=null;try{console.log("Carregando ditado com ID:",C.value);try{const n=await F.buscarPorId(C.value);console.log("Ditado carregado do backend:",n),N(n)}catch(n){if(console.log("Falha ao carregar do backend, tentando carregar lista completa..."),((t=n.response)==null?void 0:t.status)===404){const g=(await F.listarTodos()).find(M=>M.id==C.value);if(g)console.log("Ditado encontrado na lista:",g),j=g,N(g);else throw new Error("Ditado não encontrado na lista")}else throw n}}catch(n){console.error("Erro ao carregar ditado:",n);const x=((s=(a=n.response)==null?void 0:a.data)==null?void 0:s.message)||n.message||"Erro ao carregar ditado";v.value=x,m(x,"error")}finally{A.value=!1}}function N(t){if(!t)throw new Error("Ditado não encontrado");j=t,d.value={titulo:t.titulo||"",descricao:t.descricao||"",textoComMarcacoes:t.textoComMarcacoes||""}}async function q(){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});y=new MediaRecorder(t),P=[],y.ondataavailable=a=>{P.push(a.data)},y.onstop=()=>{const a=new Blob(P,{type:"audio/webm"}),s=new FileReader;s.onload=()=>{u.value=s.result},s.readAsDataURL(a),t.getTracks().forEach(n=>n.stop())},y.start(),p.value=!0,E.value=0,h=setInterval(()=>{E.value++},1e3)}catch(t){console.error("Erro ao acessar microfone:",t),m("Erro ao acessar o microfone. Verifique as permissões.","error")}}function O(){y&&p.value&&(y.stop(),p.value=!1,clearInterval(h))}function ea(){u.value=null,E.value=0,q()}async function oa(){var a,s,n,x,g,M,L;const{valid:t}=await S.value.validate();if(!t){m("Por favor, preencha todos os campos obrigatórios","warning");return}if(!d.value.titulo||!d.value.textoComMarcacoes){m("Por favor, preencha o título e o ditado","warning");return}if(!f.value&&!u.value){m("Por favor, grave um áudio","warning");return}B.value=!0,v.value=null;try{const c={titulo:d.value.titulo,descricao:d.value.descricao||"",textoComMarcacoes:d.value.textoComMarcacoes};if(u.value){const R=u.value.split(",")[1];c.audioBase64=R}f.value?(m("Funcionalidade de edição não disponível no momento","info"),setTimeout(()=>{T()},1500)):(await F.criar(c),m("Ditado cadastrado com sucesso!","success"),setTimeout(()=>{T()},1500))}catch(c){if(console.error("Erro ao salvar ditado:",((a=c.response)==null?void 0:a.data)||c),(n=(s=c.response)==null?void 0:s.data)!=null&&n.errors){const R=c.response.data.errors,ra=Object.values(R).flat().join(", ");v.value=ra}else v.value=((g=(x=c.response)==null?void 0:x.data)==null?void 0:g.message)||((L=(M=c.response)==null?void 0:M.data)==null?void 0:L.title)||"Erro ao salvar ditado";m("Erro ao salvar ditado","error")}finally{B.value=!1}}function ta(){confirm("Deseja realmente cancelar? Todas as alterações serão perdidas.")&&T()}function T(){Q.push("/professor")}function m(t,a="success"){D.value={show:!0,mensagem:t,color:a}}return da(()=>{p.value&&O(),h&&clearInterval(h)}),(t,a)=>(b(),W("div",null,[e(I,{class:"mb-6",elevation:"1"},{default:o(()=>[e(G,{class:"pa-6"},{default:o(()=>[r("div",ya,[r("div",null,[r("h1",xa,w(f.value?"Editar Ditado":"Cadastro de Ditados"),1),r("p",wa,w(f.value?"Atualize os dados do ditado":"Crie e organize ditados para futuras sessões."),1)]),e(V,{color:"primary",size:"large","prepend-icon":"mdi-view-list",variant:"outlined",class:"text-none",onClick:T},{default:o(()=>[...a[5]||(a[5]=[l(" Ver Banco ",-1)])]),_:1})])]),_:1})]),_:1}),e(I,{elevation:"1"},{default:o(()=>[e(G,{class:"pa-6"},{default:o(()=>[e(ca,{ref_key:"formDitado",ref:S},{default:o(()=>[e(va,null,{default:o(()=>[e(X,{cols:"12",md:"6"},{default:o(()=>[e(I,{elevation:"0",class:"border"},{default:o(()=>[e(H,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(U,{class:"mr-2"},{default:o(()=>[...a[6]||(a[6]=[l("mdi-text",-1)])]),_:1}),a[7]||(a[7]=l(" Detalhes do Ditado ",-1))]),_:1}),e(G,{class:"pa-6"},{default:o(()=>[r("div",Va,[a[8]||(a[8]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Título ",-1)),e(ma,{modelValue:d.value.titulo,"onUpdate:modelValue":a[0]||(a[0]=s=>d.value.titulo=s),placeholder:"Digite o título do ditado",variant:"outlined",density:"comfortable",rules:[z.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),r("div",ka,[a[9]||(a[9]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Descrição ",-1)),e(J,{modelValue:d.value.descricao,"onUpdate:modelValue":a[1]||(a[1]=s=>d.value.descricao=s),placeholder:"Descreva o objetivo ou contexto do ditado",variant:"outlined",density:"comfortable",rows:"3","hide-details":"auto"},null,8,["modelValue"])]),r("div",Ca,[a[10]||(a[10]=r("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Ditado ",-1)),e(J,{modelValue:d.value.textoComMarcacoes,"onUpdate:modelValue":a[2]||(a[2]=s=>d.value.textoComMarcacoes=s),placeholder:"Digite o texto do ditado",variant:"outlined",density:"comfortable",rows:"5",rules:[z.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),e(K,{type:"info",variant:"tonal",density:"compact"},{default:o(()=>[...a[11]||(a[11]=[r("div",{class:"text-caption"},[r("strong",null,"Como escrever:"),r("br"),l(" Use colchetes "),r("code",null,"[ ]"),l(" para marcar as palavras que serão omitidas."),r("br"),r("strong",null,"Exemplo:"),l(" O menino foi ao [parque] com seu [cachorro]. ")],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(X,{cols:"12",md:"6"},{default:o(()=>[e(I,{elevation:"0",class:"border"},{default:o(()=>[e(H,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(U,{class:"mr-2"},{default:o(()=>[...a[12]||(a[12]=[l("mdi-music",-1)])]),_:1}),a[13]||(a[13]=l(" Áudio ",-1))]),_:1}),e(G,{class:"pa-6"},{default:o(()=>[r("div",null,[r("h3",Da,[e(U,{class:"mr-2"},{default:o(()=>[...a[14]||(a[14]=[l("mdi-microphone",-1)])]),_:1}),a[15]||(a[15]=l(" Gravação direta ",-1))]),r("div",_a,[!p.value&&!u.value?(b(),_(V,{key:0,color:"error",variant:"flat","prepend-icon":"mdi-microphone",class:"text-none",onClick:q},{default:o(()=>[...a[16]||(a[16]=[l(" Iniciar ",-1)])]),_:1})):k("",!0),p.value?(b(),_(V,{key:1,color:"grey",variant:"flat","prepend-icon":"mdi-stop",class:"text-none",onClick:O},{default:o(()=>[...a[17]||(a[17]=[l(" Parar ",-1)])]),_:1})):k("",!0),u.value?(b(),_(V,{key:2,color:"primary",variant:"outlined","prepend-icon":"mdi-refresh",class:"text-none",onClick:ea},{default:o(()=>[...a[18]||(a[18]=[l(" Nova gravação ",-1)])]),_:1})):k("",!0),p.value?(b(),_(fa,{key:3,color:"error",variant:"flat"},{default:o(()=>[e(U,{start:""},{default:o(()=>[...a[19]||(a[19]=[l("mdi-circle",-1)])]),_:1}),l(" Gravando... "+w(E.value)+"s ",1)]),_:1})):k("",!0)]),u.value?(b(),W("div",Ea,[r("audio",{ref_key:"audioGravadoPlayer",ref:Z,controls:"",class:"w-100"},[r("source",{src:u.value,type:"audio/webm"},null,8,ha)],512)])):k("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),v.value?(b(),_(K,{key:0,type:"error",class:"mt-6",variant:"tonal",closable:"","onClick:close":a[3]||(a[3]=s=>v.value=null)},{default:o(()=>[l(w(v.value),1)]),_:1})):k("",!0)]),_:1},512)]),_:1}),e(pa),e(ga,{class:"pa-6 bg-grey-lighten-5"},{default:o(()=>[e(V,{variant:"text",class:"text-none","prepend-icon":"mdi-close",onClick:ta},{default:o(()=>[...a[20]||(a[20]=[l(" Cancelar ",-1)])]),_:1}),e(ba),e(V,{color:"primary",variant:"flat",size:"large",class:"text-none px-8","prepend-icon":"mdi-content-save",loading:B.value,onClick:oa},{default:o(()=>[l(w(f.value?"Atualizar Ditado":"Salvar Ditado"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),e(ia,{modelValue:D.value.show,"onUpdate:modelValue":a[4]||(a[4]=s=>D.value.show=s),color:D.value.color,timeout:3e3},{default:o(()=>[l(w(D.value.mensagem),1)]),_:1},8,["modelValue","color"])]))}},Ua=la(Ta,[["__scopeId","data-v-d64781fc"]]);export{Ua as default};
