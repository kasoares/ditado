import{_ as W,u as X,r as u,y as Y,S as G,a5 as H,O as K,a as Q,I as m,d as s,c as I,g as t,w as a,e as Z,f as j,m as h,M as ee,o as i,h as _,i as l,j as g,Y as ae,l as V,U as C,t as y,X as E,F as se,D as oe,J as P,a0 as te,ag as le,ah as re,s as ne,a4 as ie,$ as de}from"./index-D1A3MZz2.js";import{d as T}from"./ditadoService-D5zfjNmh.js";const ue={class:"realizar-ditado"},ce={class:"d-flex align-center"},pe={class:"d-flex align-center gap-4"},fe={class:"text-center"},me={class:"d-flex align-center justify-between mb-4"},ve={class:"text-h4 font-weight-bold mb-2"},ge={class:"d-flex align-center gap-4"},ye={class:"d-flex align-center justify-between"},be={class:"d-flex align-center gap-3"},_e={class:"d-flex align-center gap-2"},xe={class:"text-ditado"},ke={key:0,class:"texto-fixo"},he={key:1,class:"lacuna-container"},Ve=["onUpdate:modelValue","placeholder"],we={class:"text-body-1 mb-0"},Ie=["src"],Ce=["src"],ze=["src"],De={__name:"RealizarDitado",setup(Se){const z=Q(),B=K(),A=X(),v=u(null),w=u(null),x=u([]),c=u({}),D=u(!1),S=u(!1),d=u(null),O=u(""),U=u(""),k=u({show:!1,mensagem:"",color:"success"}),R=Y(()=>{const r=x.value.filter(e=>e.segmentoId!==null&&e.segmentoId!==void 0);return r.length===0?!1:r.every(e=>{const o=c.value[e.segmentoId];return o&&o.trim()!==""})});G(()=>{N()}),H(()=>{v.value&&(v.value.pause(),v.value.currentTime=0)});async function N(){D.value=!0;try{const r=B.params.id,e=await T.buscarParaRealizar(r);console.log("Dados do ditado:",e),w.value=e,x.value=e.segmentos||[],e.audioBase64&&(e.audioBase64.startsWith("data:")?d.value=e.audioBase64:d.value=`data:audio/mpeg;base64,${e.audioBase64}`,console.log("Áudio configurado, primeiros caracteres:",d.value.substring(0,50))),x.value.filter(o=>o.segmentoId!==null&&o.segmentoId!==void 0).forEach(o=>{c.value[o.segmentoId]=""}),console.log("Segmentos processados:",x.value),console.log("Respostas inicializadas:",Object.keys(c.value))}catch(r){console.error("Erro ao carregar ditado:",r),p("Erro ao carregar ditado","error"),setTimeout(()=>z.push("/aluno"),2e3)}finally{D.value=!1}}function q(){v.value&&d.value?(console.log("Tentando tocar áudio..."),v.value.load(),v.value.play().then(()=>{console.log("Áudio tocando com sucesso")}).catch(r=>{console.error("Erro ao tocar áudio:",r),p("Erro ao reproduzir áudio. Verifique se o formato é válido.","error")})):(console.error("Player ou áudio não disponível"),p("Áudio não disponível","error"))}function M(){}function $(){Object.keys(c.value).forEach(r=>{c.value[r]=""}),p("Campos limpos","info")}async function F(){var r,e;if(!R.value){p("Por favor, preencha todas as lacunas","warning");return}S.value=!0;try{const o=B.params.id,n=Object.entries(c.value).map(([b,J])=>({segmentoId:parseInt(b),resposta:J.trim()})),f=await T.submeterResposta(o,n);p("Respostas submetidas com sucesso!","success"),setTimeout(()=>{z.push({name:"ResultadoDitado",params:{id:f.respostaDitadoId}})},1500)}catch(o){if(console.error("Erro ao submeter respostas:",o),(e=(r=o.response)==null?void 0:r.data)!=null&&e.errors){const n=o.response.data.errors,f=Object.values(n).flat().join(", ");p(f,"error")}else p("Erro ao submeter respostas","error")}finally{S.value=!1}}function L(){confirm("Deseja realmente sair? Seu progresso será perdido.")&&z.push("/aluno")}function p(r,e="success"){k.value={show:!0,mensagem:r,color:e}}return(r,e)=>(i(),m("div",ue,[s(Z,{elevation:"0",color:"white",height:"70",class:"border-b"},{default:a(()=>[s(j,{class:"d-flex align-center justify-space-between"},{default:a(()=>[t("div",ce,[s(_,{size:"24",class:"mr-2"},{default:a(()=>[...e[1]||(e[1]=[l("mdi-headphones",-1)])]),_:1}),e[2]||(e[2]=t("span",{class:"text-h6 font-weight-bold"},"Sessão de Ditado • Aluno",-1))]),t("div",pe,[s(g,{variant:"text",class:"text-none"},{default:a(()=>[...e[3]||(e[3]=[l("Perfis",-1)])]),_:1}),s(g,{variant:"text",class:"text-none"},{default:a(()=>[...e[4]||(e[4]=[l("Sessões",-1)])]),_:1}),s(g,{variant:"text",class:"text-none"},{default:a(()=>[...e[5]||(e[5]=[l("Resultados",-1)])]),_:1}),s(g,{variant:"text","prepend-icon":"mdi-exit-to-app",color:"error",class:"text-none",onClick:L},{default:a(()=>[...e[6]||(e[6]=[l(" Sair ",-1)])]),_:1})])]),_:1})]),_:1}),D.value?(i(),I(j,{key:0,class:"py-12"},{default:a(()=>[t("div",fe,[s(ae,{indeterminate:"",color:"primary",size:"64"}),e[7]||(e[7]=t("p",{class:"text-grey mt-4"},"Carregando ditado...",-1))])]),_:1})):(i(),I(j,{key:1,class:"py-8"},{default:a(()=>{var o;return[s(V,{class:"mb-6",elevation:"1"},{default:a(()=>[s(C,{class:"pa-6"},{default:a(()=>{var n;return[t("div",me,[t("div",null,[t("h1",ve,y((n=w.value)==null?void 0:n.titulo),1),e[8]||(e[8]=t("p",{class:"text-body-1 text-grey-darken-1"}," Ouça as palavras e digite nos espaços vazios. Depois, clique em Submeter. ",-1))]),t("div",ge,[s(E,{color:"success",size:"large",variant:"flat"},{default:a(()=>{var f,b;return[s(se,{start:""},{default:a(()=>[s(_,null,{default:a(()=>[...e[9]||(e[9]=[l("mdi-account",-1)])]),_:1})]),_:1}),l(" "+y((b=(f=oe(A).usuario)==null?void 0:f.nome)==null?void 0:b.split(" ")[0])+" • "+y(O.value||"-"),1)]}),_:1}),s(E,{color:"info",size:"large",variant:"flat"},{default:a(()=>[s(_,{start:""},{default:a(()=>[...e[10]||(e[10]=[l("mdi-clock-outline",-1)])]),_:1}),l(" Tempo estimado "+y(U.value||"5-7")+" min ",1)]),_:1})])])]}),_:1})]),_:1}),s(V,{class:"mb-6",elevation:"1",color:"green-lighten-5"},{default:a(()=>[s(C,{class:"pa-6"},{default:a(()=>[t("div",ye,[t("div",be,[s(_,{size:"32",color:"green-darken-2"},{default:a(()=>[...e[11]||(e[11]=[l("mdi-volume-high",-1)])]),_:1}),e[12]||(e[12]=t("span",{class:"text-h6 font-weight-bold"},"Ouça a palavra atual",-1))]),t("div",_e,[s(g,{color:"success",variant:"flat","prepend-icon":"mdi-refresh",class:"text-none",onClick:q,disabled:!d.value},{default:a(()=>[...e[13]||(e[13]=[l(" Repetir ",-1)])]),_:1},8,["disabled"])])])]),_:1})]),_:1}),s(V,{class:"mb-6",elevation:"1"},{default:a(()=>[s(C,{class:"pa-8"},{default:a(()=>[t("div",xe,[(i(!0),m(P,null,te(x.value,(n,f)=>(i(),m(P,{key:f},[n.segmentoId===null||n.segmentoId===void 0?(i(),m("span",ke,y(n.conteudo),1)):(i(),m("span",he,[le(t("input",{"onUpdate:modelValue":b=>c.value[n.segmentoId]=b,type:"text",class:"lacuna-input",placeholder:`palavra ${n.ordem}`,onInput:M},null,40,Ve),[[re,c.value[n.segmentoId]]])]))],64))),128))]),R.value?h("",!0):(i(),I(ne,{key:0,type:"info",variant:"tonal",density:"compact",class:"mt-6"},{default:a(()=>[s(_,{start:""},{default:a(()=>[...e[14]||(e[14]=[l("mdi-information",-1)])]),_:1}),e[15]||(e[15]=l(" Você pode ouvir quantas vezes precisar. ",-1))]),_:1}))]),_:1})]),_:1}),s(V,{elevation:"1",class:"mb-6"},{default:a(()=>[s(ie,{class:"pa-6 justify-space-between"},{default:a(()=>[s(g,{color:"grey",variant:"outlined","prepend-icon":"mdi-eraser",class:"text-none",onClick:$},{default:a(()=>[...e[16]||(e[16]=[l(" Limpar campos ",-1)])]),_:1}),s(g,{color:"primary",variant:"flat",size:"large","prepend-icon":"mdi-send",class:"text-none px-8",disabled:!R.value,loading:S.value,onClick:F},{default:a(()=>[...e[17]||(e[17]=[l(" Submeter respostas ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),(o=w.value)!=null&&o.descricao?(i(),I(V,{key:0,elevation:"1"},{default:a(()=>[s(de,{class:"pa-4 bg-grey-lighten-5"},{default:a(()=>[s(_,{class:"mr-2"},{default:a(()=>[...e[18]||(e[18]=[l("mdi-lightbulb-on",-1)])]),_:1}),e[19]||(e[19]=l(" Dicas de ortografia ",-1))]),_:1}),s(C,{class:"pa-6"},{default:a(()=>[t("p",we,y(w.value.descricao),1)]),_:1})]),_:1})):h("",!0)]}),_:1})),t("audio",{ref_key:"audioPlayer",ref:v,style:{display:"none"},controls:""},[d.value?(i(),m("source",{key:0,src:d.value,type:"audio/mpeg"},null,8,Ie)):h("",!0),d.value?(i(),m("source",{key:1,src:d.value,type:"audio/wav"},null,8,Ce)):h("",!0),d.value?(i(),m("source",{key:2,src:d.value,type:"audio/webm"},null,8,ze)):h("",!0)],512),s(ee,{modelValue:k.value.show,"onUpdate:modelValue":e[0]||(e[0]=o=>k.value.show=o),color:k.value.color,timeout:3e3},{default:a(()=>[l(y(k.value.mensagem),1)]),_:1},8,["modelValue","color"])]))}},Be=W(De,[["__scopeId","data-v-bb08b74e"]]);export{Be as default};
