import{_ as ta,r as i,y as F,O as ra,P as la,a5 as sa,I as O,d as e,w as o,l as _,M as da,a as ia,o as m,W as T,g as t,t as b,j as x,i as l,n as na,c as k,m as y,U as ua,X as L,a0 as W,h as E,q as ca,a6 as X,s as Y,Y as va,G as ma,a4 as fa,S as pa}from"./index-DH_fpEp9.js";import{d as $}from"./ditadoService-Bmjo6h44.js";const ga={class:"d-flex align-center justify-space-between"},ba={class:"text-h4 font-weight-bold mb-2"},xa={class:"text-body-1 text-grey-darken-1"},ya={class:"mb-6"},Va={class:"mb-6"},ka={class:"mb-4"},wa={class:"text-h6 font-weight-bold mb-4 d-flex align-center"},Ca={class:"d-flex align-center gap-3 mb-4"},Da={key:0},_a=["src"],Ta={__name:"CadastroDitado",setup(Ea){const H=ia(),J=ra(),P=i(null),K=i(null),U=F(()=>J.params.id),f=F(()=>!!U.value),d=i({titulo:"",descricao:"",textoComMarcacoes:""}),M=i(!1),B=i(!1),p=i(null),v=i(!1),n=i(null),w=i(0);let g=null,G=[],C=null;const V=i({show:!1,mensagem:"",color:"success"}),A={obrigatorio:r=>r!=null&&r!==""||"Campo obrigatório"};la(async()=>{f.value&&await Q()});async function Q(){B.value=!0;try{const r=await $.buscarPorId(U.value);d.value={titulo:r.titulo,descricao:r.descricao||"",textoComMarcacoes:r.textoComMarcacoes}}catch(r){console.error("Erro ao carregar ditado:",r),c("Erro ao carregar ditado","error")}finally{B.value=!1}}async function R(){try{const r=await navigator.mediaDevices.getUserMedia({audio:!0});g=new MediaRecorder(r),G=[],g.ondataavailable=a=>{G.push(a.data)},g.onstop=()=>{const a=new Blob(G,{type:"audio/webm"}),s=new FileReader;s.onload=()=>{n.value=s.result,removerAudio()},s.readAsDataURL(a),r.getTracks().forEach(D=>D.stop())},g.start(),v.value=!0,w.value=0,C=setInterval(()=>{w.value++},1e3)}catch(r){console.error("Erro ao acessar microfone:",r),c("Erro ao acessar o microfone. Verifique as permissões.","error")}}function S(){g&&v.value&&(g.stop(),v.value=!1,clearInterval(C))}function Z(){n.value=null,w.value=0,R()}async function aa(){var a,s,D,j,z,N,q;const{valid:r}=await P.value.validate();if(!r){c("Por favor, preencha todos os campos obrigatórios","warning");return}if(!d.value.titulo||!d.value.textoComMarcacoes){c("Por favor, preencha o título e o ditado","warning");return}if(!f.value&&!n.value){c("Por favor, grave um áudio","warning");return}M.value=!0,p.value=null;try{const u={titulo:d.value.titulo,descricao:d.value.descricao||"",textoComMarcacoes:d.value.textoComMarcacoes};if(n.value){const I=n.value.split(",")[1];u.audioBase64=I}f.value?c("Ditado atualizado com sucesso!","success"):(await $.criar(u),c("Ditado cadastrado com sucesso!","success")),setTimeout(()=>{h()},1500)}catch(u){if(console.error("Erro ao salvar ditado:",((a=u.response)==null?void 0:a.data)||u),(D=(s=u.response)==null?void 0:s.data)!=null&&D.errors){const I=u.response.data.errors,oa=Object.values(I).flat().join(", ");p.value=oa}else p.value=((z=(j=u.response)==null?void 0:j.data)==null?void 0:z.message)||((q=(N=u.response)==null?void 0:N.data)==null?void 0:q.title)||"Erro ao salvar ditado";c("Erro ao salvar ditado","error")}finally{M.value=!1}}function ea(){confirm("Deseja realmente cancelar? Todas as alterações serão perdidas.")&&h()}function h(){H.push("/professor")}function c(r,a="success"){V.value={show:!0,mensagem:r,color:a}}return sa(()=>{v.value&&S(),C&&clearInterval(C)}),(r,a)=>(m(),O("div",null,[e(_,{class:"mb-6",elevation:"1"},{default:o(()=>[e(T,{class:"pa-6"},{default:o(()=>[t("div",ga,[t("div",null,[t("h1",ba,b(f.value?"Editar Ditado":"Cadastro de Textos"),1),t("p",xa,b(f.value?"Atualize os dados do ditado":"Crie e organize textos para futuras sessões de ditado."),1)]),e(x,{color:"primary",size:"large","prepend-icon":"mdi-view-list",variant:"outlined",class:"text-none",onClick:h},{default:o(()=>[...a[5]||(a[5]=[l(" Ver Banco ",-1)])]),_:1})])]),_:1})]),_:1}),e(_,{elevation:"1"},{default:o(()=>[e(T,{class:"pa-6"},{default:o(()=>[e(na,{ref_key:"formDitado",ref:P},{default:o(()=>[e(ua,null,{default:o(()=>[e(L,{cols:"12",md:"6"},{default:o(()=>[e(_,{elevation:"0",class:"border"},{default:o(()=>[e(W,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(E,{class:"mr-2"},{default:o(()=>[...a[6]||(a[6]=[l("mdi-text",-1)])]),_:1}),a[7]||(a[7]=l(" Detalhes do Texto ",-1))]),_:1}),e(T,{class:"pa-6"},{default:o(()=>[t("div",ya,[a[8]||(a[8]=t("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Título ",-1)),e(ca,{modelValue:d.value.titulo,"onUpdate:modelValue":a[0]||(a[0]=s=>d.value.titulo=s),placeholder:"Digite o título do ditado",variant:"outlined",density:"comfortable",rules:[A.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),t("div",Va,[a[9]||(a[9]=t("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Descrição ",-1)),e(X,{modelValue:d.value.descricao,"onUpdate:modelValue":a[1]||(a[1]=s=>d.value.descricao=s),placeholder:"Descreva o objetivo ou contexto do ditado",variant:"outlined",density:"comfortable",rows:"3","hide-details":"auto"},null,8,["modelValue"])]),t("div",ka,[a[10]||(a[10]=t("label",{class:"text-body-2 font-weight-bold text-grey-darken-2 mb-2 d-block"}," Ditado ",-1)),e(X,{modelValue:d.value.textoComMarcacoes,"onUpdate:modelValue":a[2]||(a[2]=s=>d.value.textoComMarcacoes=s),placeholder:"Digite o texto do ditado",variant:"outlined",density:"comfortable",rows:"5",rules:[A.obrigatorio],"hide-details":"auto"},null,8,["modelValue","rules"])]),e(Y,{type:"info",variant:"tonal",density:"compact"},{default:o(()=>[...a[11]||(a[11]=[t("div",{class:"text-caption"},[t("strong",null,"Como escrever:"),t("br"),l(" Use colchetes "),t("code",null,"[ ]"),l(" para marcar as palavras que serão omitidas."),t("br"),t("strong",null,"Exemplo:"),l(" O menino foi ao [parque] com seu [cachorro]. ")],-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{cols:"12",md:"6"},{default:o(()=>[e(_,{elevation:"0",class:"border"},{default:o(()=>[e(W,{class:"bg-grey-lighten-5 pa-4"},{default:o(()=>[e(E,{class:"mr-2"},{default:o(()=>[...a[12]||(a[12]=[l("mdi-music",-1)])]),_:1}),a[13]||(a[13]=l(" Áudio ",-1))]),_:1}),e(T,{class:"pa-6"},{default:o(()=>[t("div",null,[t("h3",wa,[e(E,{class:"mr-2"},{default:o(()=>[...a[14]||(a[14]=[l("mdi-microphone",-1)])]),_:1}),a[15]||(a[15]=l(" Gravação direta ",-1))]),t("div",Ca,[!v.value&&!n.value?(m(),k(x,{key:0,color:"error",variant:"flat","prepend-icon":"mdi-microphone",class:"text-none",onClick:R},{default:o(()=>[...a[16]||(a[16]=[l(" Iniciar ",-1)])]),_:1})):y("",!0),v.value?(m(),k(x,{key:1,color:"grey",variant:"flat","prepend-icon":"mdi-stop",class:"text-none",onClick:S},{default:o(()=>[...a[17]||(a[17]=[l(" Parar ",-1)])]),_:1})):y("",!0),n.value?(m(),k(x,{key:2,color:"primary",variant:"outlined","prepend-icon":"mdi-refresh",class:"text-none",onClick:Z},{default:o(()=>[...a[18]||(a[18]=[l(" Nova gravação ",-1)])]),_:1})):y("",!0),v.value?(m(),k(va,{key:3,color:"error",variant:"flat"},{default:o(()=>[e(E,{start:""},{default:o(()=>[...a[19]||(a[19]=[l("mdi-circle",-1)])]),_:1}),l(" Gravando... "+b(w.value)+"s ",1)]),_:1})):y("",!0)]),n.value?(m(),O("div",Da,[t("audio",{ref_key:"audioGravadoPlayer",ref:K,controls:"",class:"w-100"},[t("source",{src:n.value,type:"audio/webm"},null,8,_a)],512)])):y("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),p.value?(m(),k(Y,{key:0,type:"error",class:"mt-6",variant:"tonal",closable:"","onClick:close":a[3]||(a[3]=s=>p.value=null)},{default:o(()=>[l(b(p.value),1)]),_:1})):y("",!0)]),_:1},512)]),_:1}),e(ma),e(fa,{class:"pa-6 bg-grey-lighten-5"},{default:o(()=>[e(x,{variant:"text",class:"text-none","prepend-icon":"mdi-close",onClick:ea},{default:o(()=>[...a[20]||(a[20]=[l(" Cancelar ",-1)])]),_:1}),e(pa),e(x,{color:"primary",variant:"flat",size:"large",class:"text-none px-8","prepend-icon":"mdi-content-save",loading:M.value,onClick:aa},{default:o(()=>[l(b(f.value?"Atualizar Ditado":"Salvar Texto"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),e(da,{modelValue:V.value.show,"onUpdate:modelValue":a[4]||(a[4]=s=>V.value.show=s),color:V.value.color,timeout:3e3},{default:o(()=>[l(b(V.value.mensagem),1)]),_:1},8,["modelValue","color"])]))}},ha=ta(Ta,[["__scopeId","data-v-063d004e"]]);export{ha as default};
